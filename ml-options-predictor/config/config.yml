# ML Options Predictor Configuration

# Local development (M3 Pro Max)
local:
  training:
    n_jobs: 12  # All performance cores
    use_gpu: false  # Metal acceleration not yet implemented
    batch_size: 500
    min_signals_for_retrain: 50
  api:
    host: "localhost"
    port: 8001
  schedule:
    retrain_cron: "0 2 * * *"  # 2 AM daily
    enable_scheduler: false  # Disable in local dev

# Production (Server)
production:
  training:
    n_jobs: 4  # Typical VPS has 4 cores
    use_gpu: false
    batch_size: 1000
    min_signals_for_retrain: 50
  api:
    host: "0.0.0.0"
    port: 8001
  schedule:
    retrain_cron: "0 2 * * *"  # 2 AM daily
    enable_scheduler: true

# Model hyperparameters
model:
  classification:
    max_depth: 7
    learning_rate: 0.03
    n_estimators: 500
    min_child_weight: 5
    subsample: 0.8
    colsample_bytree: 0.8
    scale_pos_weight: 1.0  # Will be calculated based on class imbalance
  
  regression:
    max_depth: 6
    learning_rate: 0.05
    n_estimators: 300
    min_child_weight: 3
    subsample: 0.8
    colsample_bytree: 0.8

# Feature engineering
features:
  # Base features from signals
  signal_quality: ["grade", "overall_score", "confidence"]
  volume_metrics: ["volume_ratio", "current_volume", "average_volume"]
  premium_metrics: ["premium_flow", "aggressive_order_pct"]
  detection_flags: [
    "has_volume_anomaly",
    "has_oi_spike",
    "has_premium_flow",
    "has_sweep",
    "has_block_trade"
  ]
  greeks_volatility: ["implied_volatility", "iv_rank"]
  moneyness: ["moneyness"]
  time_factors: ["days_to_expiry", "days_to_earnings"]
  market_context: ["sentiment", "put_call_ratio", "market_cap"]
  
  # Derived features
  derived:
    - "premium_flow_per_volume"
    - "score_confidence_interaction"
    - "strike_distance_pct"
    - "iv_time_interaction"
    - "time_decay_risk"

# Labeling configuration
labeling:
  # Minimum price data quality
  min_price_data_points: 1  # At least have expiry day price
  
  # Return calculation
  estimate_premium_from_iv: true  # Estimate premium if not available
  
  # Quality filters
  max_price_gap_pct: 0.50  # Flag if price gap > 50% (possible split/error)
  
# Model versioning
versioning:
  keep_last_n_versions: 5
  min_improvement_threshold: 0.01  # Deploy if AUC improves by 1%
  
# Monitoring
monitoring:
  track_predictions: true
  alert_threshold_auc_drop: 0.05  # Alert if AUC drops 5%
  data_drift_check_interval_days: 7

